# 改造计划
## 单体系统改造
- √ 修改轮询规则，可根据情况注入不同的轮询规则
- √ 使用策略模式修改匹配规则
- √ 抽取 Redis 工具类，完成缓存穿透，缓存击穿的通用方法
- √ 拆分模块，将 game 部分拆分成一个单独的模块（game耗费的资源多，CPU密集型，因此将该部分拆分成单独的模块）
- √ 使用 mq 完成输赢信息的异步写入，避免大量游戏对局压垮数据库
- √ 确保消息可以正常达到 mq。
- √ 使用 Spring 重试机制，发送方发送消息失败时重试，接收方接收消息时失败重试
- Redis 优化 WebSocketServer 中的操作（目前还剩 Bot 的 Redis 缓存没做，写完后 WebSocketServer 中就无需查询数据库了）
- 思考，Bot 需要和用户信息一样常駐内存嗎？
- 解决问题，后端数据发送太快，前端无法及时处理
  - 如果是bot代码与bot代码对战，后端数据发送太快，前端无法及时处理。采用前端缓存后端数据，后开启定时器定期消费后端发送过来的数据。
  - 对局信息插入数据库后更新缓存中的天梯分和对局次数。
- 解决问题，消息的重复消费
  - 如何确保 mq 的消息不重复消费。此处采用 mq 手动 ack + Redis，消费数据后将数据的 id 存入 Redis，一分钟后过期，每次消费数据时先看 Redis 中是否有，有说明是重复数据，直接抛弃。
## 分布式系统改造
- x 使用 SpringCloud 改造服务。